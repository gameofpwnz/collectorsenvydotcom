<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Collectors Envy ‚Ä¢ Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      /* CollectorsEnvy.com homepage-ish: clean, dark, minimal */
      --bg: #000000;
      --panel: rgba(255,255,255,0.03);
      --panel-2: rgba(255,255,255,0.05);
      --line: rgba(255,255,255,0.10);
      --line-2: rgba(255,255,255,0.16);

      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.62);
      --muted-2: rgba(255,255,255,0.48);

      /* Slight ‚ÄúCollectors Envy‚Äù pop on hover/focus */
      --accent: #00F0FF;
      --accent-soft: rgba(0,240,255,0.12);

      --shadow: 0 18px 45px rgba(0,0,0,0.65);
      --radius-xl: 18px;
      --radius: 14px;

      /* Helps native controls render dark dropdowns */
      color-scheme: dark;
    }

    html { color-scheme: dark; }
    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 22px 14px 40px;
    }

    .shell {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border-radius: var(--radius-xl);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      padding: 18px 16px 18px;
    }

    @media (min-width: 768px) {
      .shell { padding: 22px 26px 22px; }
    }

    /* ===== Top nav (homepage link list vibe) ===== */
    .topnav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 12px;
      align-items: center;
      padding: 6px 0 14px;
      border-bottom: 1px solid var(--line);
      margin-bottom: 14px;
    }

    .topnav a {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      color: rgba(255,255,255,0.88);
      text-decoration: none;
      border: 1px solid transparent;
      background: transparent;
      font-size: 13.5px;
      line-height: 1;
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.12s ease;
    }

    .topnav a:hover {
      background: rgba(255,255,255,0.05);
      border-color: rgba(0,240,255,0.25);
      transform: translateY(-1px);
    }

    .dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: rgba(255,255,255,0.55);
      box-shadow: 0 0 0 2px rgba(255,255,255,0.06);
      flex: 0 0 auto;
    }

    .topnav a:hover .dot {
      background: var(--accent);
      box-shadow: 0 0 0 2px rgba(0,240,255,0.10);
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 10px 0 14px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.25rem 0.8rem;
      border-radius: 999px;
      font-size: 0.75rem;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.82);
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--line);
      width: fit-content;
    }

    header h1 {
      margin: 0;
      font-size: clamp(1.6rem, 2.4vw + 1rem, 2.2rem);
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 0.6rem;
      letter-spacing: 0.2px;
    }

    .year-badge {
      font-size: 0.85rem;
      font-weight: 500;
      color: rgba(255,255,255,0.85);
      padding: 0.18rem 0.7rem;
      border-radius: 999px;
      background: rgba(0,240,255,0.08);
      border: 1px solid rgba(0,240,255,0.25);
    }

    .subtitle {
      margin: 0;
      font-size: 0.95rem;
      color: var(--muted);
    }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin: 12px 0 14px;
      align-items: center;
    }

    .controls-group {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      flex: 1;
      min-width: 260px;
    }

    .field {
      flex: 1;
      min-width: 170px;
      position: relative;
    }

    label {
      display: block;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.10em;
      color: var(--muted-2);
      margin-bottom: 0.25rem;
    }

    input[type="search"], select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,0.35);
      padding: 0.62rem 0.9rem;
      padding-left: 2.25rem;
      color: var(--text);
      font-size: 0.92rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input[type="search"]::placeholder { color: rgba(255,255,255,0.38); }

    input[type="search"]:focus, select:focus {
      border-color: rgba(0,240,255,0.70);
      box-shadow: 0 0 0 4px rgba(0,240,255,0.12);
      background: rgba(255,255,255,0.03);
    }

    .field-icon {
      position: absolute;
      left: 0.9rem;
      top: 50%;
      transform: translateY(10%);
      font-size: 0.9rem;
      color: rgba(255,255,255,0.42);
      pointer-events: none;
    }

    /* ===== Fix dropdown (white-on-white) ===== */
    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-color: rgba(0,0,0,0.35);
      color: var(--text);

      /* Add a custom arrow (since appearance:none hides it) */
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.55) 50%),
        linear-gradient(135deg, rgba(255,255,255,0.55) 50%, transparent 50%);
      background-position:
        calc(100% - 18px) calc(50% - 2px),
        calc(100% - 12px) calc(50% - 2px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
      padding-right: 2.2rem;
    }

    select option,
    select optgroup {
      background-color: #0b0b0b;
      color: rgba(255,255,255,0.92);
    }

    select option:checked {
      background-color: rgba(0,240,255,0.18);
      color: rgba(255,255,255,0.95);
    }

    .pill-btn {
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.88);
      font-size: 0.88rem;
      padding: 0.58rem 1.05rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.45rem;
      white-space: nowrap;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.1s ease, border-color 0.1s ease;
    }

    .pill-btn:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(0,240,255,0.30);
      box-shadow: 0 10px 24px rgba(0,0,0,0.55);
      transform: translateY(-1px);
    }

    .pill-btn:active { transform: translateY(0); box-shadow: none; }

    /* Events container */
    .events-wrapper {
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--line);
      max-height: 70vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .events-header {
      padding: 0.85rem 1.1rem;
      border-bottom: 1px solid var(--line);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.82rem;
      color: var(--muted);
    }

    .events-header strong {
      color: rgba(255,255,255,0.90);
      font-weight: 600;
    }

    .events-list {
      padding: 0.5rem 0.9rem 0.9rem;
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .events-list::-webkit-scrollbar { width: 8px; }
    .events-list::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.18);
      border-radius: 999px;
    }

    /* Year + month groups */
    .year-group { margin-bottom: 1.3rem; }

    .year-heading-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0.35rem 0 0.55rem;
    }

    .year-heading {
      font-size: 1.05rem;
      font-weight: 700;
      margin: 0;
      display: inline-flex;
      align-items: baseline;
      gap: 0.45rem;
      letter-spacing: 0.2px;
    }

    .year-heading-badge {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--muted-2);
      opacity: 0.9;
      font-weight: 500;
    }

    .year-divider {
      flex: 1;
      height: 1px;
      background: linear-gradient(to right, var(--line-2), rgba(255,255,255,0));
    }

    .month-title {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(255,255,255,0.55);
      margin: 0.85rem 0 0.4rem;
      display: flex;
      align-items: center;
      gap: 0.45rem;
    }

    .month-title::before {
      content: "";
      display: inline-block;
      width: 18px;
      height: 1px;
      background: linear-gradient(to right, rgba(255,255,255,0.20), rgba(255,255,255,0.05));
    }

    /* Event card */
    .event-card {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 0.85rem;
      padding: 0.72rem 0.85rem;
      margin-bottom: 0.50rem;
      border-radius: var(--radius);
      background: var(--panel);
      border: 1px solid var(--line);
      position: relative;
      transition: border-color 0.12s ease, transform 0.08s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .event-card:hover {
      border-color: rgba(0,240,255,0.45);
      transform: translateY(-1px);
      box-shadow: 0 14px 28px rgba(0,0,0,0.60);
      background: radial-gradient(circle at 10% 0%, rgba(0,240,255,0.10), transparent 55%), var(--panel-2);
    }

    .date-pill {
      min-width: 82px;
      border-radius: 12px;
      padding: 0.38rem 0.55rem;
      text-align: center;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.14rem;
    }

    .date-pill .day {
      font-size: 0.98rem;
      font-weight: 700;
      line-height: 1.1;
      color: rgba(255,255,255,0.92);
    }

    .date-pill .month {
      font-size: 0.7rem;
      letter-spacing: 0.13em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.60);
    }

    .date-pill .dow {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.42);
    }

    .event-body {
      display: flex;
      flex-direction: column;
      gap: 0.18rem;
      min-width: 0;
    }

    .event-title-row {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.45rem;
    }

    .event-title {
      font-size: 0.98rem;
      font-weight: 650;
      color: rgba(255,255,255,0.92);
    }

    .event-time {
      font-size: 0.82rem;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      white-space: nowrap;
    }

    .event-time::before { content: "‚è∞"; font-size: 0.85rem; }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.05rem;
    }

    .meta-tag {
      font-size: 0.76rem;
      padding: 0.12rem 0.55rem;
      border-radius: 999px;
      border: 1px solid var(--line);
      color: rgba(255,255,255,0.62);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      background: rgba(255,255,255,0.03);
    }

    .meta-tag.location::before { content: "üìç"; }
    .meta-tag.category::before { content: "üè∑Ô∏è"; }

    .event-description {
      margin-top: 0.12rem;
      font-size: 0.86rem;
      color: rgba(255,255,255,0.78);
      line-height: 1.45;
    }

    .actions-row {
      margin-top: 0.35rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.45rem;
    }

    .btn-link {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.80rem;
      padding: 0.30rem 0.75rem;
      border-radius: 999px;
      border: 1px solid var(--line);
      text-decoration: none;
      color: rgba(255,255,255,0.88);
      background: rgba(255,255,255,0.04);
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.08s ease, box-shadow 0.12s ease;
    }

    .btn-link.info::before { content: "‚ÑπÔ∏è"; font-size: 0.92rem; }
    .btn-link.tickets::before { content: "üéüÔ∏è"; font-size: 0.92rem; }

    .btn-link:hover {
      background: rgba(255,255,255,0.06);
      border-color: rgba(0,240,255,0.30);
      box-shadow: 0 10px 20px rgba(0,0,0,0.55);
      transform: translateY(-0.5px);
    }

    .btn-link.tickets { border-color: rgba(255,255,255,0.18); }
    .btn-link.tickets:hover { border-color: rgba(0,240,255,0.30); }

    .summary {
      padding: 0.75rem 1.1rem 0.9rem;
      border-top: 1px solid var(--line);
      font-size: 0.82rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 0.6rem;
      align-items: center;
    }

    .summary a {
      color: rgba(255,255,255,0.88);
      text-decoration: none;
      border-bottom: 1px solid rgba(255,255,255,0.20);
    }
    .summary a:hover { border-bottom-color: rgba(0,240,255,0.70); }

    @media (max-width: 640px) {
      body { padding: 14px 10px 28px; }
      .shell { border-radius: 16px; padding: 16px 14px 16px; }
      .event-card { grid-template-columns: 1fr; }
      .date-pill {
        flex-direction: row;
        justify-content: flex-start;
        gap: 0.45rem;
        min-width: unset;
      }
    }
  </style>
</head>

<body>
  <div class="shell">
    <nav class="topnav" aria-label="Collectors Envy links">
      <a href="https://www.collectorsenvy.com/" rel="noopener"><span class="dot"></span>Home</a>
      <a href="https://discord.gg/RgnNBhkzUc" target="_blank" rel="noopener noreferrer"><span class="dot"></span>Discord</a>
      <a href="https://x.com/Collectors_Envy" target="_blank" rel="noopener noreferrer"><span class="dot"></span>X</a>
    </nav>

    <header>
      <div class="chip">Our Group ‚Ä¢ Events</div>
      <h1>
        Collectors Envy Event Calendar
        <span class="year-badge" id="yearLabel"></span>
      </h1>
      <p class="subtitle">Browse all our events, neatly organized by year and month.</p>
    </header>

    <section class="controls">
      <div class="controls-group">
        <div class="field" style="flex-basis:100%;">
          <label for="searchInput">Search</label>
          <span class="field-icon">üîé</span>
          <input type="search" id="searchInput" placeholder="Search by title, location, or description‚Ä¶" />
        </div>

        <div class="field">
          <label for="yearFilter">Year</label>
          <span class="field-icon">üìÖ</span>
          <select id="yearFilter">
            <option value="all">All years</option>
          </select>
        </div>

        <div class="field">
          <label for="monthFilter">Month</label>
          <span class="field-icon">üóìÔ∏è</span>
          <select id="monthFilter">
            <option value="all">All months</option>
          </select>
        </div>
      </div>

      <button class="pill-btn" id="jumpNextBtn" type="button">
        <span class="icon">üìç</span>
        Jump to next event
      </button>
    </section>

    <section class="events-wrapper">
      <div class="events-header">
        <div>
          <strong id="countLabel">0 events</strong>
          <span id="filterLabel"></span>
        </div>
        <div id="rangeLabel"></div>
      </div>

      <div class="events-list" id="eventsList"></div>

      <div class="summary">
        <div>Say hi to us at the events!.</div>
        <div><a href="https://www.collectorsenvy.com/">Back to collectorsenvy.com</a></div>
      </div>
    </section>
  </div>

  <script>
    // =====================================================
    // 1. DEFINE YOUR EVENTS HERE
    // =====================================================
    const events = [
      {
        date: "2026-01-29",
        endDate: "2026-02-01",
        title: "2026 Call of Duty League OpTic Texas Major I, presented by Monster Energy",
        time: "All day",
        location: "Moody Coliseum - Dallas, TX",
        category: "Tournament",
        description: "The 2026 CDL Major I, presented by Monster Energy, takes over Moody Coliseum, launching the new season in the heart of Dallas, Texas. OpTic Texas hosts a weekend packed with elite Call of Duty competition, high-energy crowds, and nonstop action in the first Major of the season. Experience every moment live as the journey to the 2026 World Championship begins in Dallas from January 29 - February 1, 2026.",
        linkUrl: "https://discord.gg/RgnNBhkzUc",
        linkText: "Discord Channel",
        ticketsUrl: "https://www.tixr.com/groups/optictexas/events/optic-texas-major-i-presented-by-monster-energy-166248",
        ticketsText: "Tickets"
      },
      {
        date: "2026-03-06",
        title: "OpTic Gaming x Dallas Stars Night",
        time: "7:00PM",
        location: "American Airlines Center - Dallas, TX",
        category: "Promotional",
        description: "OpTic Gaming night as the Dallas Stars take on the Colorado Avalanche.",
        linkUrl: "https://discord.gg/tgMptqqyzp",
        linkText: "Discord Channel",
        ticketsUrl: "https://www.gofevo.com/event/Videogame26",
        ticketsText: "Tickets"
      },
      {
        date: "2026-03-27",
        endDate: "2026-03-29",
        title: "Dreamhack Birmingham",
        time: "All day",
        location: "National Exhibition Centre - Birmingham, UK",
        category: "Tournament",
        description: "ESL ONE, CDL MAJOR II, EXPO",
        linkUrl: "https://discord.gg/ahGTZdEKKW",
        linkText: "Discord Channel",
        ticketsUrl: "https://dreamhack.com/birmingham/tickets/?utm_source=birmingham&utm_medium=front_button&utm_campaign=ab_test&utm_content=dreamhack",
        ticketsText: "Tickets"
      },
      {
        date: "2026-05-15",
        endDate: "2026-05-17",
        title: "Dreamhack Atlanta",
        time: "All day",
        location: "Georgia World Congress Center - Atlanta, GA",
        category: "Tournament",
        description: "IEM, CDL MAJOR III, HALO, EXPO",
        linkUrl: "https://discord.gg/MGYGS5Baex",
        linkText: "Discord Channel",
        ticketsUrl: "https://dreamhack.com/atlanta/tickets/",
        ticketsText: "Tickets"
      },
      {
        date: "2026-06-25",
        endDate: "2026-06-28",
        title: "2026 Call of Duty League Major IV",
        time: "All day",
        location: "Paris, France",
        category: "Tournament",
        description: "CDL Major IV Tourney",
        linkUrl: "https://discord.gg/F3x2fuR2fW",
        linkText: "Discord Channel",
        ticketsUrl: "#",
        ticketsText: "Tickets"
      },
      {
        date: "2026-07-16",
        endDate: "2026-07-19",
        title: "2026 Call of Duty League Championship (Hosted by Vegas FaZe)",
        time: "All day",
        location: "Las Vegas, NV",
        category: "Tournament",
        description: "CDL Champs",
        linkUrl: "https://discord.gg/2bgN5RVVN6",
        linkText: "Discord Channel",
        ticketsUrl: "#",
        ticketsText: "Tickets"
      }
    ];

    // =====================================================
    // 2. HELPERS
    // =====================================================
    function parseDate(dateStr) {
      return new Date(dateStr + "T12:00:00");
    }

    function formatDateParts(dateStr) {
      const d = parseDate(dateStr);
      return {
        raw: d,
        year: d.getFullYear(),
        monthIndex: d.getMonth(),
        day: String(d.getDate()).padStart(2, "0"),
        monthShort: d.toLocaleString(undefined, { month: "short" }),
        monthLabel: d.toLocaleString(undefined, { month: "long" }),
        dow: d.toLocaleString(undefined, { weekday: "short" })
      };
    }

    function groupByYearAndMonth(eventsArr) {
      const groups = {};
      eventsArr.forEach(evt => {
        const parts = formatDateParts(evt.date);
        const y = parts.year;
        const m = parts.monthIndex;

        if (!groups[y]) groups[y] = {};
        if (!groups[y][m]) {
          groups[y][m] = { label: parts.monthLabel, events: [] };
        }
        groups[y][m].events.push(evt);
      });
      return groups;
    }

    function getNextUpcomingIndex(sortedEvents) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      for (let i = 0; i < sortedEvents.length; i++) {
        const d = new Date(sortedEvents[i].date + "T00:00:00");
        if (d >= today) return i;
      }
      return sortedEvents.length - 1;
    }

    function formatRange(sortedEvents) {
      if (!sortedEvents.length) return "";
      const first = parseDate(sortedEvents[0].date);
      const last = parseDate(sortedEvents[sortedEvents.length - 1].date);
      const opts = { month: "short", day: "numeric" };
      if (first.getFullYear() !== last.getFullYear()) {
        return (
          first.toLocaleDateString(undefined, { ...opts, year: "numeric" }) +
          " ‚Äì " +
          last.toLocaleDateString(undefined, { ...opts, year: "numeric" })
        );
      }
      return (
        first.toLocaleDateString(undefined, opts) +
        " ‚Äì " +
        last.toLocaleDateString(undefined, { ...opts, year: "numeric" })
      );
    }

    // =====================================================
    // 3. DOM ELEMENTS
    // =====================================================
    const eventsListEl = document.getElementById("eventsList");
    const yearFilterEl = document.getElementById("yearFilter");
    const monthFilterEl = document.getElementById("monthFilter");
    const searchInputEl = document.getElementById("searchInput");
    const jumpNextBtnEl = document.getElementById("jumpNextBtn");
    const countLabelEl = document.getElementById("countLabel");
    const filterLabelEl = document.getElementById("filterLabel");
    const rangeLabelEl = document.getElementById("rangeLabel");
    const yearLabelEl = document.getElementById("yearLabel");

    let currentFiltered = [];
    let sortedAll = [];

    // =====================================================
    // 4. FILTER DROPDOWNS
    // =====================================================
    function populateYearFilter(allEventsSorted) {
      const years = Array.from(
        new Set(allEventsSorted.map(e => formatDateParts(e.date).year))
      ).sort((a, b) => a - b);

      yearFilterEl.innerHTML = '<option value="all">All years</option>';
      years.forEach(y => {
        const opt = document.createElement("option");
        opt.value = String(y);
        opt.textContent = y;
        yearFilterEl.appendChild(opt);
      });
    }

    function populateMonthFilter(sourceEvents) {
      const seen = new Set();
      monthFilterEl.innerHTML = '<option value="all">All months</option>';

      sourceEvents.forEach(evt => {
        const p = formatDateParts(evt.date);
        if (!seen.has(p.monthIndex)) {
          seen.add(p.monthIndex);
          const opt = document.createElement("option");
          opt.value = String(p.monthIndex);
          opt.textContent = p.monthLabel;
          monthFilterEl.appendChild(opt);
        }
      });
    }

    // =====================================================
    // 5. RENDERING
    // =====================================================
    function renderEvents() {
      const searchTerm = searchInputEl.value.trim().toLowerCase();
      const yearValue = yearFilterEl.value;
      const monthValue = monthFilterEl.value;

      let filtered = [...events].sort((a, b) => parseDate(a.date) - parseDate(b.date));

      if (yearValue !== "all") {
        const yearInt = parseInt(yearValue, 10);
        filtered = filtered.filter(evt => formatDateParts(evt.date).year === yearInt);
      }

      if (monthValue !== "all") {
        const monthIndexFilter = parseInt(monthValue, 10);
        filtered = filtered.filter(evt => formatDateParts(evt.date).monthIndex === monthIndexFilter);
      }

      if (searchTerm) {
        filtered = filtered.filter(evt => {
          const text =
            (evt.title || "") + " " +
            (evt.location || "") + " " +
            (evt.description || "") + " " +
            (evt.category || "");
          return text.toLowerCase().includes(searchTerm);
        });
      }

      currentFiltered = filtered;
      eventsListEl.innerHTML = "";

      if (!filtered.length) {
        const div = document.createElement("div");
        div.style.padding = "0.9rem 0.2rem 1.1rem";
        div.style.fontSize = "0.88rem";
        div.style.color = "rgba(255,255,255,0.60)";
        div.textContent = "No matching events. Try clearing filters or adjusting your search.";
        eventsListEl.appendChild(div);

        countLabelEl.textContent = "0 events";
        filterLabelEl.textContent = "";
        rangeLabelEl.textContent = "";
        return;
      }

      const groups = groupByYearAndMonth(filtered);
      const yearsSorted = Object.keys(groups).map(Number).sort((a, b) => a - b);

      yearsSorted.forEach(year => {
        const yearGroupDiv = document.createElement("div");
        yearGroupDiv.className = "year-group";

        const yearHeadingRow = document.createElement("div");
        yearHeadingRow.className = "year-heading-row";

        const yearHeading = document.createElement("div");
        yearHeading.className = "year-heading";
        yearHeading.textContent = year;

        const yearBadge = document.createElement("span");
        yearBadge.className = "year-heading-badge";
        yearBadge.textContent = "Year";
        yearHeading.appendChild(yearBadge);

        const yearDivider = document.createElement("div");
        yearDivider.className = "year-divider";

        yearHeadingRow.appendChild(yearHeading);
        yearHeadingRow.appendChild(yearDivider);
        yearGroupDiv.appendChild(yearHeadingRow);

        const monthsObj = groups[year];
        const monthIndexes = Object.keys(monthsObj).map(Number).sort((a, b) => a - b);

        monthIndexes.forEach(mIndex => {
          const monthInfo = monthsObj[mIndex];

          const monthTitle = document.createElement("h3");
          monthTitle.className = "month-title";
          monthTitle.textContent = monthInfo.label;
          yearGroupDiv.appendChild(monthTitle);

          monthInfo.events
            .sort((a, b) => parseDate(a.date) - parseDate(b.date))
            .forEach(evt => {
              const start = formatDateParts(evt.date);
              let end = null;
              if (evt.endDate) end = formatDateParts(evt.endDate);

              const card = document.createElement("article");
              card.className = "event-card";
              card.setAttribute("data-start-date", evt.date);

              const datePill = document.createElement("div");
              datePill.className = "date-pill";

              if (!end || start.raw.getTime() === end.raw.getTime()) {
                datePill.innerHTML = `
                  <div class="day">${start.day}</div>
                  <div class="month">${start.monthShort}</div>
                  <div class="dow">${start.dow}</div>
                `;
              } else {
                const sameMonthAndYear =
                  start.monthShort === end.monthShort && start.year === end.year;

                const dayRange = sameMonthAndYear
                  ? `${start.day}‚Äì${end.day}`
                  : `${start.monthShort} ${start.day}‚Äì${end.monthShort} ${end.day}`;

                const dowRange = `${start.dow}‚Äì${end.dow}`;

                datePill.innerHTML = `
                  <div class="day">${dayRange}</div>
                  <div class="month">${start.year}</div>
                  <div class="dow">${dowRange}</div>
                `;
              }

              card.appendChild(datePill);

              const body = document.createElement("div");
              body.className = "event-body";

              const titleRow = document.createElement("div");
              titleRow.className = "event-title-row";

              const titleEl = document.createElement("div");
              titleEl.className = "event-title";
              titleEl.textContent = evt.title || "(Untitled event)";
              titleRow.appendChild(titleEl);

              if (evt.time) {
                const timeEl = document.createElement("div");
                timeEl.className = "event-time";
                timeEl.textContent = evt.time;
                titleRow.appendChild(timeEl);
              }

              body.appendChild(titleRow);

              const metaRow = document.createElement("div");
              metaRow.className = "meta-row";

              if (evt.location) {
                const loc = document.createElement("span");
                loc.className = "meta-tag location";
                loc.textContent = evt.location;
                metaRow.appendChild(loc);
              }

              if (evt.category) {
                const cat = document.createElement("span");
                cat.className = "meta-tag category";
                cat.textContent = evt.category;
                metaRow.appendChild(cat);
              }

              if (metaRow.childNodes.length) body.appendChild(metaRow);

              if (evt.description) {
                const desc = document.createElement("div");
                desc.className = "event-description";
                desc.textContent = evt.description;
                body.appendChild(desc);
              }

              if ((evt.linkUrl && evt.linkText) || (evt.ticketsUrl && evt.ticketsText)) {
                const actionsRow = document.createElement("div");
                actionsRow.className = "actions-row";

                if (evt.linkUrl && evt.linkText) {
                  const infoLink = document.createElement("a");
                  infoLink.className = "btn-link info";
                  infoLink.href = evt.linkUrl;
                  infoLink.target = "_blank";
                  infoLink.rel = "noopener noreferrer";
                  infoLink.textContent = evt.linkText;
                  actionsRow.appendChild(infoLink);
                }

                if (evt.ticketsUrl && evt.ticketsText) {
                  const ticketsLink = document.createElement("a");
                  ticketsLink.className = "btn-link tickets";
                  ticketsLink.href = evt.ticketsUrl;
                  ticketsLink.target = "_blank";
                  ticketsLink.rel = "noopener noreferrer";
                  ticketsLink.textContent = evt.ticketsText;
                  actionsRow.appendChild(ticketsLink);
                }

                body.appendChild(actionsRow);
              }

              card.appendChild(body);
              yearGroupDiv.appendChild(card);
            });
        });

        eventsListEl.appendChild(yearGroupDiv);
      });

      countLabelEl.textContent = filtered.length + (filtered.length === 1 ? " event" : " events");

      const filterBits = [];
      if (yearValue !== "all") filterBits.push(yearValue);
      if (monthValue !== "all") {
        const monthIndexFilter = parseInt(monthValue, 10);
        const anyEvt = filtered.find(e => formatDateParts(e.date).monthIndex === monthIndexFilter);
        if (anyEvt) filterBits.push(formatDateParts(anyEvt.date).monthLabel);
      }
      if (searchTerm) filterBits.push(`matching ‚Äú${searchTerm}‚Äù`);

      filterLabelEl.textContent = filterBits.length ? " ¬∑ " + filterBits.join(" ¬∑ ") : "";
      rangeLabelEl.textContent = formatRange(filtered);
    }

    function scrollToNextEvent() {
      if (!currentFiltered.length) return;

      const sorted = [...currentFiltered].sort((a, b) => parseDate(a.date) - parseDate(b.date));
      const idx = getNextUpcomingIndex(sorted);
      const targetDate = sorted[idx].date;

      let targetCard = eventsListEl.querySelector(`.event-card[data-start-date="${targetDate}"]`);
      const allCards = eventsListEl.querySelectorAll(".event-card");
      if (!targetCard && allCards.length) targetCard = allCards[0];

      if (targetCard) targetCard.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    function updateYearBadge() {
      if (!events.length) {
        yearLabelEl.textContent = "No events";
        return;
      }
      const years = Array.from(new Set(events.map(e => parseDate(e.date).getFullYear()))).sort((a, b) => a - b);
      yearLabelEl.textContent = years.length === 1 ? years[0] : years[0] + "‚Äì" + years[years.length - 1];
    }

    document.addEventListener("DOMContentLoaded", () => {
      sortedAll = [...events].sort((a, b) => parseDate(a.date) - parseDate(b.date));

      updateYearBadge();
      populateYearFilter(sortedAll);
      populateMonthFilter(sortedAll);
      renderEvents();

      yearFilterEl.addEventListener("change", () => {
        const yearValue = yearFilterEl.value;
        const base =
          yearValue === "all"
            ? sortedAll
            : sortedAll.filter(e => formatDateParts(e.date).year === parseInt(yearValue, 10));
        populateMonthFilter(base);
        renderEvents();
      });

      monthFilterEl.addEventListener("change", renderEvents);
      searchInputEl.addEventListener("input", renderEvents);
      jumpNextBtnEl.addEventListener("click", scrollToNextEvent);
    });
  </script>

  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015"
    integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ=="
    data-cf-beacon='{"version":"2024.11.0","token":"0cd917d33eff449dae63885bb4704a00","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}'
    crossorigin="anonymous"></script>
</body>
</html>
